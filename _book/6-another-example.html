<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Statistical Computing Course Notes</title>
  <meta name="description" content="Statistical Computing Course Notes">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Statistical Computing Course Notes" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="dereksonderegger/578" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Statistical Computing Course Notes" />
  
  
  

<meta name="author" content="Derek L. Sonderegger">


<meta name="date" content="2017-08-31">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="5-linear-and-quadratic-discriminant-analysis.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Computing</a></li>
<li><a href="https://dereksonderegger.github.io/578/Statistical_Computing.pdf" target="blank">PDF version</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a><ul>
<li class="chapter" data-level="2.1" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#classical-functions-for-summarizing-rows-and-columns"><i class="fa fa-check"></i><b>2.1</b> Classical functions for summarizing rows and columns</a><ul>
<li class="chapter" data-level="2.1.1" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#summary"><i class="fa fa-check"></i><b>2.1.1</b> <code>summary()</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#apply"><i class="fa fa-check"></i><b>2.1.2</b> <code>apply()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#package-dplyr"><i class="fa fa-check"></i><b>2.2</b> Package <code>dplyr</code></a><ul>
<li class="chapter" data-level="2.2.1" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#verbs"><i class="fa fa-check"></i><b>2.2.1</b> Verbs</a></li>
<li class="chapter" data-level="2.2.2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#split-apply-combine"><i class="fa fa-check"></i><b>2.2.2</b> Split, apply, combine</a></li>
<li class="chapter" data-level="2.2.3" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#chaining-commands-together"><i class="fa fa-check"></i><b>2.2.3</b> Chaining commands together</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#exercises"><i class="fa fa-check"></i><b>2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-data-reshaping.html"><a href="3-data-reshaping.html"><i class="fa fa-check"></i><b>3</b> Data Reshaping</a><ul>
<li class="chapter" data-level="3.1" data-path="3-data-reshaping.html"><a href="3-data-reshaping.html#tidyr"><i class="fa fa-check"></i><b>3.1</b> <code>tidyr</code></a><ul>
<li class="chapter" data-level="3.1.1" data-path="3-data-reshaping.html"><a href="3-data-reshaping.html#verbs-1"><i class="fa fa-check"></i><b>3.1.1</b> Verbs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-data-reshaping.html"><a href="3-data-reshaping.html#storing-data-in-multiple-tables"><i class="fa fa-check"></i><b>3.2</b> Storing Data in Multiple Tables</a></li>
<li class="chapter" data-level="3.3" data-path="3-data-reshaping.html"><a href="3-data-reshaping.html#table-joins"><i class="fa fa-check"></i><b>3.3</b> Table Joins</a></li>
<li class="chapter" data-level="3.4" data-path="3-data-reshaping.html"><a href="3-data-reshaping.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-markov-chain-monte-carlo.html"><a href="4-markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>4</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="4.1" data-path="4-markov-chain-monte-carlo.html"><a href="4-markov-chain-monte-carlo.html#generating-usim-uniform01"><i class="fa fa-check"></i><b>4.1</b> Generating <span class="math inline">\(U\sim Uniform(0,1)\)</span></a></li>
<li class="chapter" data-level="4.2" data-path="4-markov-chain-monte-carlo.html"><a href="4-markov-chain-monte-carlo.html#inverse-cdf-method"><i class="fa fa-check"></i><b>4.2</b> Inverse CDF Method</a></li>
<li class="chapter" data-level="4.3" data-path="4-markov-chain-monte-carlo.html"><a href="4-markov-chain-monte-carlo.html#acceptreject-algorithm"><i class="fa fa-check"></i><b>4.3</b> Accept/Reject Algorithm</a></li>
<li class="chapter" data-level="4.4" data-path="4-markov-chain-monte-carlo.html"><a href="4-markov-chain-monte-carlo.html#mcmc-algorithm"><i class="fa fa-check"></i><b>4.4</b> MCMC algorithm</a><ul>
<li class="chapter" data-level="4.4.1" data-path="4-markov-chain-monte-carlo.html"><a href="4-markov-chain-monte-carlo.html#mixture-of-normals"><i class="fa fa-check"></i><b>4.4.1</b> Mixture of normals</a></li>
<li class="chapter" data-level="4.4.2" data-path="4-markov-chain-monte-carlo.html"><a href="4-markov-chain-monte-carlo.html#common-problems"><i class="fa fa-check"></i><b>4.4.2</b> Common problems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-linear-and-quadratic-discriminant-analysis.html"><a href="5-linear-and-quadratic-discriminant-analysis.html"><i class="fa fa-check"></i><b>5</b> Linear and Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="6" data-path="6-another-example.html"><a href="6-another-example.html"><i class="fa fa-check"></i><b>6</b> Another example</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Computing Course Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="another-example" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Another example</h1>
<pre><code>## Skipping install of &#39;dsData&#39; from a github remote, the SHA1 (208be54a) has not changed since last install.
##   Use `force = TRUE` to force installation</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&#39;dereksonderegger/dsData&#39;</span>)  <span class="co"># repository of my data sets</span></code></pre></div>
<pre><code>## Skipping install of &#39;dsData&#39; from a github remote, the SHA1 (208be54a) has not changed since last install.
##   Use `force = TRUE` to force installation</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dsData)
<span class="kw">data</span>(<span class="st">&quot;Hemocrit&quot;</span>, <span class="dt">package=</span><span class="st">&#39;dsData&#39;</span>)</code></pre></div>
<p>We now consider a case where the number of observations is not the same between groups. Here we consider the case where we are interested in using hemocrit levels to detect if a cyclist is cheating.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#?Hemocrit</span>
<span class="kw">ggplot</span>(Hemocrit, <span class="kw">aes</span>(<span class="dt">x=</span>hemocrit, <span class="dt">y=</span>status)) +<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="Statistical_Computing_Notes_files/figure-html/unnamed-chunk-89-1.png" width="576" /></p>
<p>What if I just naively assume that all professional cyclists are clean? How accurate is this prediction scheme?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(  Hemocrit$status ==<span class="st"> &#39;Clean&#39;</span> )</code></pre></div>
<pre><code>## [1] 0.95</code></pre>
<p>In this case, I am pretty accurate because we correctly classify 95% of the cases! Clearly we should be more intelligent. Lets use the LDA to fit a model that uses hemocrit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw">lda</span>(status ~<span class="st"> </span>hemocrit, <span class="dt">data=</span>Hemocrit)
Hemocrit$yhat &lt;-<span class="st"> </span><span class="kw">predict</span>(model)$class
<span class="kw">table</span>( <span class="dt">Truth=</span>Hemocrit$status, <span class="dt">Predicted=</span>Hemocrit$yhat)</code></pre></div>
<pre><code>##        Predicted
## Truth   Clean Cheat
##   Clean   188     2
##   Cheat     6     4</code></pre>
<p>So this method basically looks to see if the hemocrit level is greater than</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="fl">47.91</span> +<span class="st"> </span><span class="fl">50.14</span>)/<span class="dv">2</span></code></pre></div>
<pre><code>## [1] 49.025</code></pre>
<p>and calls them a cheater. Can we choose something a bit more clever? The predict.lda() function also returns the posterior probabilities for each class. In this case, it chooses the category with the highest probability (for two classes than means whichever is greater than 0.50). We can create a different rule that labels somebody a cheater only if the posterior probability is greater than 0.8 or whatever.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred &lt;-<span class="st"> </span><span class="kw">predict</span>(model)
Hemocrit$yhat &lt;-<span class="st"> </span><span class="kw">ifelse</span>( pred$posterior[,<span class="dv">2</span>] &lt;=<span class="st"> </span>.<span class="dv">8</span>, <span class="st">&#39;Clean&#39;</span>, <span class="st">&#39;Cheat&#39;</span> )
<span class="kw">mean</span>(  Hemocrit$status ==<span class="st"> </span>Hemocrit$yhat )</code></pre></div>
<pre><code>## [1] 0.97</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(Hemocrit, <span class="kw">aes</span>(<span class="dt">x=</span>hemocrit, <span class="dt">y=</span>status, <span class="dt">color=</span>yhat)) +<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="Statistical_Computing_Notes_files/figure-html/unnamed-chunk-93-1.png" width="672" /> Great, now we have no false-positives, but a number of folks are getting away with cheating. But what if we back that up, how many false positives do we get… What we want is a graph that compares my false-positive numbers to the true-positives.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cut.offs &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length=</span><span class="dv">1001</span>)
results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cut.off=</span>cut.offs, 
                      <span class="dt">false.positive.rate=</span><span class="kw">rep</span>(<span class="ot">NA</span>,<span class="dv">1001</span>), 
                       <span class="dt">true.positive.rate=</span><span class="kw">rep</span>(<span class="ot">NA</span>,<span class="dv">1001</span>))
for( i in <span class="dv">1</span>:<span class="kw">length</span>(cut.offs) ){
  Hemocrit$yhat &lt;-<span class="st"> </span><span class="kw">ifelse</span>( pred$posterior[,<span class="dv">2</span>] &lt;=<span class="st"> </span>cut.offs[i], <span class="st">&#39;Clean&#39;</span>, <span class="st">&#39;Cheat&#39;</span> )
  <span class="co"># get the factor levels ordered the same way that Hemocrit$status has</span>
  Hemocrit$yhat &lt;-<span class="st"> </span><span class="kw">factor</span>(Hemocrit$yhat, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&#39;Clean&#39;</span>, <span class="st">&#39;Cheat&#39;</span>)) 
  
  confusion &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="dt">Truth=</span>Hemocrit$status, <span class="dt">Prediction=</span>Hemocrit$yhat)  
  results[i,<span class="st">&#39;false.positive.rate&#39;</span>] &lt;-<span class="st"> </span>confusion[<span class="dv">1</span>,<span class="dv">2</span>] /<span class="st"> </span><span class="kw">sum</span>( confusion[<span class="dv">1</span>,])
  results[i, <span class="st">&#39;true.positive.rate&#39;</span>] &lt;-<span class="st"> </span>confusion[<span class="dv">2</span>,<span class="dv">2</span>] /<span class="st"> </span><span class="kw">sum</span>( confusion[<span class="dv">2</span>,])
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make sure we don&#39;t wiggle due to repeated observations</span>
results &lt;-<span class="st"> </span>results %&gt;%<span class="st"> </span><span class="kw">arrange</span>(false.positive.rate, true.positive.rate)
<span class="kw">ggplot</span>(results, <span class="kw">aes</span>(<span class="dt">x=</span>false.positive.rate, <span class="dt">y=</span>true.positive.rate)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">ggtitle</span>( <span class="st">&#39;ROC&#39;</span> )</code></pre></div>
<p><img src="Statistical_Computing_Notes_files/figure-html/unnamed-chunk-95-1.png" width="480" /></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="5-linear-and-quadratic-discriminant-analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dereksonderegger/Statistical_Comptuing_Book/raw/master/04_LDA.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
