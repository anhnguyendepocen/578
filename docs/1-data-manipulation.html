<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>STA 578 - Statistical Computing Notes</title>
  <meta name="description" content="STA 578 - Statistical Computing Notes">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="STA 578 - Statistical Computing Notes" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="STA 578 - Statistical Computing Notes" />
  
  
  

<meta name="author" content="Derek Sonderegger">


<meta name="date" content="2017-11-26">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="2-markov-chain-monte-carlo.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Computing</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html"><i class="fa fa-check"></i><b>1</b> Data Manipulation</a><ul>
<li class="chapter" data-level="1.1" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#classic-r-functions-for-summarizing-rows-and-columns"><i class="fa fa-check"></i><b>1.1</b> Classic R functions for summarizing rows and columns</a><ul>
<li class="chapter" data-level="1.1.1" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#summary"><i class="fa fa-check"></i><b>1.1.1</b> <code>summary()</code></a></li>
<li class="chapter" data-level="1.1.2" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#apply"><i class="fa fa-check"></i><b>1.1.2</b> <code>apply()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#package-dplyr"><i class="fa fa-check"></i><b>1.2</b> Package <code>dplyr</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#verbs"><i class="fa fa-check"></i><b>1.2.1</b> Verbs</a></li>
<li class="chapter" data-level="1.2.2" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#split-apply-combine"><i class="fa fa-check"></i><b>1.2.2</b> Split, apply, combine</a></li>
<li class="chapter" data-level="1.2.3" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#chaining-commands-together"><i class="fa fa-check"></i><b>1.2.3</b> Chaining commands together</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#reshaping-data"><i class="fa fa-check"></i><b>1.3</b> Reshaping data</a><ul>
<li class="chapter" data-level="1.3.1" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#tidyr"><i class="fa fa-check"></i><b>1.3.1</b> <code>tidyr</code></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#storing-data-in-multiple-tables"><i class="fa fa-check"></i><b>1.4</b> Storing Data in Multiple Tables</a><ul>
<li class="chapter" data-level="1.4.1" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#table-joins"><i class="fa fa-check"></i><b>1.4.1</b> Table Joins</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="1-data-manipulation.html"><a href="1-data-manipulation.html#exercises"><i class="fa fa-check"></i><b>1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>2</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="2.1" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#generating-usim-uniform01"><i class="fa fa-check"></i><b>2.1</b> Generating <span class="math inline">\(U\sim Uniform(0,1)\)</span></a></li>
<li class="chapter" data-level="2.2" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#inverse-cdf-method"><i class="fa fa-check"></i><b>2.2</b> Inverse CDF Method</a></li>
<li class="chapter" data-level="2.3" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#acceptreject-algorithm"><i class="fa fa-check"></i><b>2.3</b> Accept/Reject Algorithm</a></li>
<li class="chapter" data-level="2.4" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#mcmc-algorithm"><i class="fa fa-check"></i><b>2.4</b> MCMC algorithm</a><ul>
<li class="chapter" data-level="2.4.1" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#mixture-of-normals"><i class="fa fa-check"></i><b>2.4.1</b> Mixture of normals</a></li>
<li class="chapter" data-level="2.4.2" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#common-problems"><i class="fa fa-check"></i><b>2.4.2</b> Common problems</a></li>
<li class="chapter" data-level="2.4.3" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#assessing-chain-convergence"><i class="fa fa-check"></i><b>2.4.3</b> Assessing Chain Convergence</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#multi-variate-mcmc"><i class="fa fa-check"></i><b>2.5</b> Multi-variate MCMC</a></li>
<li class="chapter" data-level="2.6" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#hamiltonian-mcmc"><i class="fa fa-check"></i><b>2.6</b> Hamiltonian MCMC</a></li>
<li class="chapter" data-level="2.7" data-path="2-markov-chain-monte-carlo.html"><a href="2-markov-chain-monte-carlo.html#exercises-1"><i class="fa fa-check"></i><b>2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-overview-of-statistical-learning.html"><a href="3-overview-of-statistical-learning.html"><i class="fa fa-check"></i><b>3</b> Overview of Statistical Learning</a><ul>
<li class="chapter" data-level="3.1" data-path="3-overview-of-statistical-learning.html"><a href="3-overview-of-statistical-learning.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>3.1</b> K-Nearest Neighbors</a><ul>
<li class="chapter" data-level="3.1.1" data-path="3-overview-of-statistical-learning.html"><a href="3-overview-of-statistical-learning.html#knn-for-classification"><i class="fa fa-check"></i><b>3.1.1</b> KNN for Classification</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-overview-of-statistical-learning.html"><a href="3-overview-of-statistical-learning.html#knn-for-regression"><i class="fa fa-check"></i><b>3.1.2</b> KNN for Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-overview-of-statistical-learning.html"><a href="3-overview-of-statistical-learning.html#splitting-into-a-test-and-training-sets"><i class="fa fa-check"></i><b>3.2</b> Splitting into a test and training sets</a></li>
<li class="chapter" data-level="3.3" data-path="3-overview-of-statistical-learning.html"><a href="3-overview-of-statistical-learning.html#exercises-2"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html"><i class="fa fa-check"></i><b>4</b> Classification with LDA, QDA, and KNN</a><ul>
<li class="chapter" data-level="4.1" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#logistic-regression"><i class="fa fa-check"></i><b>4.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="4.2" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#roc-curves"><i class="fa fa-check"></i><b>4.2</b> ROC Curves</a></li>
<li class="chapter" data-level="4.3" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#linear-discriminent-analysis"><i class="fa fa-check"></i><b>4.3</b> Linear Discriminent Analysis</a></li>
<li class="chapter" data-level="4.4" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#quadratic-discriminent-analysis"><i class="fa fa-check"></i><b>4.4</b> Quadratic Discriminent Analysis</a></li>
<li class="chapter" data-level="4.5" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#examples"><i class="fa fa-check"></i><b>4.5</b> Examples</a><ul>
<li class="chapter" data-level="4.5.1" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#iris-data"><i class="fa fa-check"></i><b>4.5.1</b> Iris Data</a></li>
<li class="chapter" data-level="4.5.2" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#detecting-blood-doping"><i class="fa fa-check"></i><b>4.5.2</b> Detecting Blood Doping</a></li>
<li class="chapter" data-level="4.5.3" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#d-example"><i class="fa fa-check"></i><b>4.5.3</b> 2-d Example</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="4-classification-with-lda-qda-and-knn.html"><a href="4-classification-with-lda-qda-and-knn.html#exercises-3"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html"><i class="fa fa-check"></i><b>5</b> Resampling Methods</a><ul>
<li class="chapter" data-level="5.1" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#cross-validation"><i class="fa fa-check"></i><b>5.1</b> Cross-validation</a><ul>
<li class="chapter" data-level="5.1.1" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#validation-sets-approach"><i class="fa fa-check"></i><b>5.1.1</b> Validation Sets Approach</a></li>
<li class="chapter" data-level="5.1.2" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#leave-one-out-cross-validation-loocv."><i class="fa fa-check"></i><b>5.1.2</b> Leave one out Cross Validation (LOOCV).</a></li>
<li class="chapter" data-level="5.1.3" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>5.1.3</b> K-fold cross validation</a></li>
<li class="chapter" data-level="5.1.4" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#repeated-k-fold-cross-validation"><i class="fa fa-check"></i><b>5.1.4</b> Repeated K-fold cross validation</a></li>
<li class="chapter" data-level="5.1.5" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#using-cross-validation-to-select-a-tuning-parameter"><i class="fa fa-check"></i><b>5.1.5</b> Using cross validation to select a tuning parameter</a></li>
<li class="chapter" data-level="5.1.6" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#comparing-two-analysis-techniques"><i class="fa fa-check"></i><b>5.1.6</b> Comparing two analysis techniques</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#bootstrapping"><i class="fa fa-check"></i><b>5.2</b> Bootstrapping</a><ul>
<li class="chapter" data-level="5.2.1" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#observational-studies-vs-designed-experiments"><i class="fa fa-check"></i><b>5.2.1</b> Observational Studies vs Designed Experiments</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#confidence-interval-types"><i class="fa fa-check"></i><b>5.2.2</b> Confidence Interval Types</a></li>
<li class="chapter" data-level="5.2.3" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#using-carboot-function"><i class="fa fa-check"></i><b>5.2.3</b> Using <code>car::Boot()</code> function</a></li>
<li class="chapter" data-level="5.2.4" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#using-the-boot-package"><i class="fa fa-check"></i><b>5.2.4</b> Using the <code>boot</code> package</a></li>
<li class="chapter" data-level="5.2.5" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#including-blockingstratifying-variables"><i class="fa fa-check"></i><b>5.2.5</b> Including Blocking/Stratifying Variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-resampling-methods.html"><a href="5-resampling-methods.html#exercises-4"><i class="fa fa-check"></i><b>5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html"><i class="fa fa-check"></i><b>6</b> Model Selection and Regularization</a><ul>
<li class="chapter" data-level="6.1" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html#stepwise-selection-using-aic"><i class="fa fa-check"></i><b>6.1</b> Stepwise selection using AIC</a><ul>
<li class="chapter" data-level="6.1.1" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html#adjusted-r-sq"><i class="fa fa-check"></i><b>6.1.1</b> Adjusted <code>R-sq</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html#example"><i class="fa fa-check"></i><b>6.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html#model-regularization-via-lasso-and-ridge-regression"><i class="fa fa-check"></i><b>6.2</b> Model Regularization via LASSO and Ridge Regression</a><ul>
<li class="chapter" data-level="6.2.1" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html#regression"><i class="fa fa-check"></i><b>6.2.1</b> Regression</a></li>
<li class="chapter" data-level="6.2.2" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html#classification"><i class="fa fa-check"></i><b>6.2.2</b> Classification</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-model-selection-and-regularization.html"><a href="6-model-selection-and-regularization.html#exercises-5"><i class="fa fa-check"></i><b>6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-beyond-linearity.html"><a href="7-beyond-linearity.html"><i class="fa fa-check"></i><b>7</b> Beyond Linearity</a><ul>
<li class="chapter" data-level="7.1" data-path="7-beyond-linearity.html"><a href="7-beyond-linearity.html#locally-weighted-scatterplot-smoothing-loess"><i class="fa fa-check"></i><b>7.1</b> Locally Weighted Scatterplot Smoothing (LOESS)</a></li>
<li class="chapter" data-level="7.2" data-path="7-beyond-linearity.html"><a href="7-beyond-linearity.html#piecewise-linear"><i class="fa fa-check"></i><b>7.2</b> Piecewise linear</a></li>
<li class="chapter" data-level="7.3" data-path="7-beyond-linearity.html"><a href="7-beyond-linearity.html#smoothing-splines"><i class="fa fa-check"></i><b>7.3</b> Smoothing Splines</a></li>
<li class="chapter" data-level="7.4" data-path="7-beyond-linearity.html"><a href="7-beyond-linearity.html#gams"><i class="fa fa-check"></i><b>7.4</b> GAMS</a></li>
<li class="chapter" data-level="7.5" data-path="7-beyond-linearity.html"><a href="7-beyond-linearity.html#exercises-6"><i class="fa fa-check"></i><b>7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html"><i class="fa fa-check"></i><b>8</b> Classification and Regression Trees</a><ul>
<li class="chapter" data-level="8.1" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html#decision-trees"><i class="fa fa-check"></i><b>8.1</b> Decision Trees</a><ul>
<li class="chapter" data-level="8.1.1" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html#regression-examples"><i class="fa fa-check"></i><b>8.1.1</b> Regression Examples</a></li>
<li class="chapter" data-level="8.1.2" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html#classification-examples"><i class="fa fa-check"></i><b>8.1.2</b> Classification Examples</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html#bagging"><i class="fa fa-check"></i><b>8.2</b> Bagging</a></li>
<li class="chapter" data-level="8.3" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html#random-forests"><i class="fa fa-check"></i><b>8.3</b> Random Forests</a></li>
<li class="chapter" data-level="8.4" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html#boosting"><i class="fa fa-check"></i><b>8.4</b> Boosting</a></li>
<li class="chapter" data-level="8.5" data-path="8-classification-and-regression-trees.html"><a href="8-classification-and-regression-trees.html#exercises-7"><i class="fa fa-check"></i><b>8.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html"><i class="fa fa-check"></i><b>9</b> Support Vector Machines</a><ul>
<li class="chapter" data-level="9.1" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#maximal-marginal-classifier"><i class="fa fa-check"></i><b>9.1</b> Maximal Marginal Classifier</a></li>
<li class="chapter" data-level="9.2" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#support-vector-classifier"><i class="fa fa-check"></i><b>9.2</b> Support Vector Classifier</a></li>
<li class="chapter" data-level="9.3" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#support-vector-machines-1"><i class="fa fa-check"></i><b>9.3</b> Support Vector Machines</a></li>
<li class="chapter" data-level="9.4" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#predictions"><i class="fa fa-check"></i><b>9.4</b> Predictions</a></li>
<li class="chapter" data-level="9.5" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#svm-tuning"><i class="fa fa-check"></i><b>9.5</b> SVM Tuning</a></li>
<li class="chapter" data-level="9.6" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#response-with-multiple-categories"><i class="fa fa-check"></i><b>9.6</b> Response with multiple categories</a></li>
<li class="chapter" data-level="9.7" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#regression-using-svms"><i class="fa fa-check"></i><b>9.7</b> Regression using SVMs</a></li>
<li class="chapter" data-level="9.8" data-path="9-support-vector-machines.html"><a href="9-support-vector-machines.html#exercises-8"><i class="fa fa-check"></i><b>9.8</b> Exercises</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA 578 - Statistical Computing Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulation" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Data Manipulation</h1>
<p>Most of the time, our data is in the form of a data frame and we are interested in exploring the relationships. This chapter explores how to manipulate data frames and methods.</p>
<div id="classic-r-functions-for-summarizing-rows-and-columns" class="section level2">
<h2><span class="header-section-number">1.1</span> Classic R functions for summarizing rows and columns</h2>
<div id="summary" class="section level3">
<h3><span class="header-section-number">1.1.1</span> <code>summary()</code></h3>
<p>The first method is to calculate some basic summary statistics (minimum, 25th, 50th, 75th percentiles, maximum and mean) of each column. If a column is categorical, the summary function will return the number of observations in each category.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use the iris data set which has both numerical and categorical variables</span>
<span class="kw">data</span>( iris )
<span class="kw">str</span>(iris)    <span class="co"># recall what columns we have </span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># display the summary for each column</span>
<span class="kw">summary</span>( iris )</code></pre></div>
<pre><code>##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
##  Median :5.800   Median :3.000   Median :4.350   Median :1.300  
##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
##        Species  
##  setosa    :50  
##  versicolor:50  
##  virginica :50  
##                 
##                 
## </code></pre>
</div>
<div id="apply" class="section level3">
<h3><span class="header-section-number">1.1.2</span> <code>apply()</code></h3>
<p>The summary function is convenient, but we want the ability to pick another function to apply to each column and possibly to each row. To demonstrate this, suppose we have data frame that contains students grades over the semester.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make up some data</span>
grades &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">l.name =</span> <span class="kw">c</span>(<span class="st">&#39;Cox&#39;</span>, <span class="st">&#39;Dorian&#39;</span>, <span class="st">&#39;Kelso&#39;</span>, <span class="st">&#39;Turk&#39;</span>),
  <span class="dt">Exam1 =</span> <span class="kw">c</span>(<span class="dv">93</span>, <span class="dv">89</span>, <span class="dv">80</span>, <span class="dv">70</span>),
  <span class="dt">Exam2 =</span> <span class="kw">c</span>(<span class="dv">98</span>, <span class="dv">70</span>, <span class="dv">82</span>, <span class="dv">85</span>),
  <span class="dt">Final =</span> <span class="kw">c</span>(<span class="dv">96</span>, <span class="dv">85</span>, <span class="dv">81</span>, <span class="dv">92</span>) )</code></pre></div>
<p>The <code>apply()</code> function will apply an arbitrary function to each row (or column) of a matrix or a data frame and then aggregate the results into a vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Because I can&#39;t take the mean of the last names column,</span>
<span class="co"># remove the name column</span>
scores &lt;-<span class="st"> </span>grades[,<span class="op">-</span><span class="dv">1</span>]
scores</code></pre></div>
<pre><code>##   Exam1 Exam2 Final
## 1    93    98    96
## 2    89    70    85
## 3    80    82    81
## 4    70    85    92</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Summarize each column by calculating the mean.</span>
<span class="kw">apply</span>( scores,      <span class="co"># what object do I want to apply the function to</span>
       <span class="dt">MARGIN=</span><span class="dv">2</span>,    <span class="co"># rows = 1, columns = 2, (same order as [rows, cols]</span>
       <span class="dt">FUN=</span>mean     <span class="co"># what function do we want to apply     </span>
     )</code></pre></div>
<pre><code>## Exam1 Exam2 Final 
## 83.00 83.75 88.50</code></pre>
<p>To apply a function to the rows, we just change which margin we want. We might want to calculate the average exam score for person.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">apply</span>( scores,      <span class="co"># what object do I want to apply the function to</span>
       <span class="dt">MARGIN=</span><span class="dv">1</span>,    <span class="co"># rows = 1, columns = 2, (same order as [rows, cols]</span>
       <span class="dt">FUN=</span>mean     <span class="co"># what function do we want to apply</span>
     )</code></pre></div>
<pre><code>## [1] 95.66667 81.33333 81.00000 82.33333</code></pre>
<p>This is useful, but it would be more useful to concatenate this as a new column in my grades data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">average &lt;-<span class="st"> </span><span class="kw">apply</span>( 
  scores,      <span class="co"># what object do I want to apply the function to</span>
  <span class="dt">MARGIN=</span><span class="dv">1</span>,    <span class="co"># rows = 1, columns = 2, (same order as [rows, cols]</span>
  <span class="dt">FUN=</span>mean     <span class="co"># what function do we want to apply</span>
)
grades &lt;-<span class="st"> </span><span class="kw">cbind</span>( grades, average ) <span class="co"># squish together </span>
grades</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667
## 2 Dorian    89    70    85 81.33333
## 3  Kelso    80    82    81 81.00000
## 4   Turk    70    85    92 82.33333</code></pre>
<p>There are several variants of the <code>apply()</code> function, and the variant I use most often is the function <code>sapply()</code>, which will apply a function to each element of a list or vector and returns a corresponding list or vector of results.</p>
</div>
</div>
<div id="package-dplyr" class="section level2">
<h2><span class="header-section-number">1.2</span> Package <code>dplyr</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)   <span class="co"># load the dplyr package!</span></code></pre></div>
<p>Many of the tools to manipulate data frames in R were written without a consistent syntax and are difficult use together. To remedy this, Hadley Wickham (the writer of <code>ggplot2</code>) introduced a package called plyr which was quite useful. As with many projects, his first version was good but not great and he introduced an improved version that works exclusively with data.frames called <code>dplyr</code> which we will investigate. The package <code>dplyr</code> strives to provide a convenient and consistent set of functions to handle the most common data frame manipulations and a mechanism for chaining these operations together to perform complex tasks.</p>
<p>The Dr Wickham has put together a very nice introduction to the package that explains in more detail how the various pieces work and I encourage you to read it at some point. [<a href="http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html" class="uri">http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html</a>].</p>
<p>One of the aspects about the <code>data.frame</code> object is that R does some simplification for you, but it does not do it in a consistent manner. Somewhat obnoxiously character strings are always converted to factors and subsetting might return a <code>data.frame</code> or a <code>vector</code> or a <code>scalar</code>. This is fine at the command line, but can be problematic when programming. Furthermore, many operations are pretty slow using <code>data.frame</code>. To get around this, Dr Wickham introduced a modified version of the <code>data.frame</code> called a <code>tibble</code>. A <code>tibble</code> is a <code>data.frame</code> but with a few extra bits. For now we can ignore the differences.</p>
<p>The pipe command <code>%&gt;%</code> allows for very readable code. The idea is that the <code>%&gt;%</code> operator works by translating the command <code>a %&gt;% f(b)</code> to the expression <code>f(a,b)</code>. This operator works on any function and was introduced in the <code>magrittr</code> package. The beauty of this comes when you have a suite of functions that takes input arguments of the same type as their output.</p>
<p>For example if we wanted to start with <code>x</code>, and first apply function <code>f()</code>, then <code>g()</code>, and then <code>h()</code>, the usual R command would be <code>h(g(f(x)))</code> which is hard to read because you have to start reading at the innermost set of parentheses. Using the pipe command <code>%&gt;%</code>, this sequence of operations becomes <code>x %&gt;% f() %&gt;% g() %&gt;% h()</code>.</p>
<p>Dr Wickham gave the following example of readability:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bopping</span>(
  <span class="kw">scooping_up</span>(
    <span class="kw">hopping_through</span>(foo_foo),
    field_mice),
  head)</code></pre></div>
<p>is more readably written:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">foo_foo <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">hopping_through</span>(forest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">scooping_up</span>( field_mice) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bopping</span>( head )</code></pre></div>
<p>In <code>dplyr</code>, all the functions below take a data set as its first argument and outputs an appropriately modified data set. This will allow me to chain together commands in a readable fashion.</p>
<div id="verbs" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Verbs</h3>
<p>The foundational operations to perform on a data set are:</p>
<ul>
<li><p>Subsetting - Returns a with only particular columns or rows</p>
<p>– <code>select</code> - Selecting a subset of columns by name or column number.</p>
<p>– <code>filter</code> - Selecting a subset of rows from a data frame based on logical expressions.</p>
<p>– <code>slice</code> - Selecting a subset of rows by row number.</p></li>
<li><p><code>arrange</code> - Re-ordering the rows of a data frame.</p></li>
<li><p><code>mutate</code> - Add a new column that is some function of other columns.</p></li>
<li><p><code>summarise</code> - calculate some summary statistic of a column of data. This collapses a set of rows into a single row.</p></li>
</ul>
<p>Each of these operations is a function in the package <code>dplyr</code>. These functions all have a similar calling syntax, the first argument is a data set, subsequent arguments describe what to do with the input data frame and you can refer to the columns without using the <code>df$column</code> notation. All of these functions will return a data set.</p>
<div id="subsetting-with-select-filter-and-slice" class="section level4">
<h4><span class="header-section-number">1.2.1.1</span> Subsetting with <code>select</code>, <code>filter</code>, and <code>slice</code></h4>
<p>These function allows you select certain columns and rows of a data frame.</p>
<div id="select" class="section level5">
<h5><span class="header-section-number">1.2.1.1.1</span> <code>select()</code></h5>
<p>Often you only want to work with a small number of columns of a data frame. It is relatively easy to do this using the standard <code>[,col.name]</code> notation, but is often pretty tedious.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># recall what the grades are</span>
grades</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667
## 2 Dorian    89    70    85 81.33333
## 3  Kelso    80    82    81 81.00000
## 4   Turk    70    85    92 82.33333</code></pre>
<p>I could select the columns Exam columns by hand, or by using an extension of the <code>:</code> operator</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>( Exam1, Exam2 )   <span class="co"># Exam1 and Exam2</span></code></pre></div>
<pre><code>##   Exam1 Exam2
## 1    93    98
## 2    89    70
## 3    80    82
## 4    70    85</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>( Exam1<span class="op">:</span>Final )    <span class="co"># Columns Exam1 through Final</span></code></pre></div>
<pre><code>##   Exam1 Exam2 Final
## 1    93    98    96
## 2    89    70    85
## 3    80    82    81
## 4    70    85    92</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>( <span class="op">-</span>Exam1 )         <span class="co"># Negative indexing by name works</span></code></pre></div>
<pre><code>##   l.name Exam2 Final  average
## 1    Cox    98    96 95.66667
## 2 Dorian    70    85 81.33333
## 3  Kelso    82    81 81.00000
## 4   Turk    85    92 82.33333</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>( <span class="dv">1</span><span class="op">:</span><span class="dv">2</span> )            <span class="co"># Can select column by column position</span></code></pre></div>
<pre><code>##   l.name Exam1
## 1    Cox    93
## 2 Dorian    89
## 3  Kelso    80
## 4   Turk    70</code></pre>
<p>The <code>select()</code> command has a few other tricks. There are functional calls that describe the columns you wish to select that take advantage of pattern matching. I generally can get by with <code>starts_with()</code>, <code>ends_with()</code>, and <code>contains()</code>, but there is a final operator <code>matches()</code> that takes a regular expression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>( <span class="kw">starts_with</span>(<span class="st">&#39;Exam&#39;</span>) )   <span class="co"># Exam1 and Exam2</span></code></pre></div>
<pre><code>##   Exam1 Exam2
## 1    93    98
## 2    89    70
## 3    80    82
## 4    70    85</code></pre>
</div>
<div id="filter" class="section level5">
<h5><span class="header-section-number">1.2.1.1.2</span> <code>filter()</code></h5>
<p>It is common to want to select particular rows where we have some logically expression to pick the rows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># select students with Final grades greater than 90</span>
grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Final <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span>)</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667
## 2   Turk    70    85    92 82.33333</code></pre>
<p>You can have multiple logical expressions to select rows and they will be logically combined so that only rows that satisfy all of the conditions are selected. The logicals are joined together using <code>&amp;</code> (and) operator or the <code>|</code> (or) operator and you may explicitly use other logicals. For example a factor column type might be used to select rows where type is either one or two via the following: <code>type==1 | type==2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># select students with Final grades above 90 and</span>
<span class="co"># average score also above 90</span>
grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Final <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span>, average <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span>)</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we could also use an &quot;and&quot; condition</span>
grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Final <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span> <span class="op">&amp;</span><span class="st"> </span>average <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span>)</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667</code></pre>
</div>
<div id="slice" class="section level5">
<h5><span class="header-section-number">1.2.1.1.3</span> <code>slice()</code></h5>
<p>When you want to filter rows based on row number, this is called slicing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># grab the first 2 rows</span>
grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   l.name Exam1 Exam2 Final  average
##   &lt;fctr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1    Cox    93    98    96 95.66667
## 2 Dorian    89    70    85 81.33333</code></pre>
</div>
</div>
<div id="arrange" class="section level4">
<h4><span class="header-section-number">1.2.1.2</span> <code>arrange()</code></h4>
<p>We often need to re-order the rows of a data frame. For example, we might wish to take our grade book and sort the rows by the average score, or perhaps alphabetically. The <code>arrange()</code> function does exactly that. The first argument is the data frame to re-order, and the subsequent arguments are the columns to sort on. The order of the sorting column determines the precedent… the first sorting column is first used and the second sorting column is only used to break ties.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(l.name)</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667
## 2 Dorian    89    70    85 81.33333
## 3  Kelso    80    82    81 81.00000
## 4   Turk    70    85    92 82.33333</code></pre>
<p>The default sorting is in ascending order, so to sort the grades with the highest scoring person in the first row, we must tell arrange to do it in descending order using <code>desc(column.name)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Final))</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667
## 2   Turk    70    85    92 82.33333
## 3 Dorian    89    70    85 81.33333
## 4  Kelso    80    82    81 81.00000</code></pre>
<p>In a more complicated example, consider the following data and we want to order it first by Treatment Level and secondarily by the y-value. I want the Treatment level in the default ascending order (Low, Medium, High), but the y variable in descending order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make some data</span>
dd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Trt =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;High&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;Low&quot;</span>),        
               <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>)),
  <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">9</span>),      
  <span class="dt">z =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)) 
dd</code></pre></div>
<pre><code>##    Trt y z
## 1 High 8 1
## 2  Med 3 1
## 3 High 9 1
## 4  Low 9 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># arrange the rows first by treatment, and then by y (y in descending order)</span>
dd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Trt, <span class="kw">desc</span>(y))</code></pre></div>
<pre><code>##    Trt y z
## 1  Low 9 2
## 2  Med 3 1
## 3 High 9 1
## 4 High 8 1</code></pre>
</div>
<div id="mutate" class="section level4">
<h4><span class="header-section-number">1.2.1.3</span> mutate()</h4>
<p>I often need to create a new column that is some function of the old columns. This was often cumbersome. Consider code to calculate the average grade in my grade book example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades<span class="op">$</span>average &lt;-<span class="st"> </span>(grades<span class="op">$</span>Exam1 <span class="op">+</span><span class="st"> </span>grades<span class="op">$</span>Exam2 <span class="op">+</span><span class="st"> </span>grades<span class="op">$</span>Final) <span class="op">/</span><span class="st"> </span><span class="dv">3</span></code></pre></div>
<p>Instead, we could use the <code>mutate()</code> function and avoid all the <code>grades$</code> nonsense.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>( <span class="dt">average =</span> (Exam1 <span class="op">+</span><span class="st"> </span>Exam2 <span class="op">+</span><span class="st"> </span>Final)<span class="op">/</span><span class="dv">3</span> )</code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average
## 1    Cox    93    98    96 95.66667
## 2 Dorian    89    70    85 81.33333
## 3  Kelso    80    82    81 81.00000
## 4   Turk    70    85    92 82.33333</code></pre>
<p>You can do multiple calculations within the same <code>mutate()</code> command, and you can even refer to columns that were created in the same <code>mutate()</code> command.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>( 
  <span class="dt">average =</span> (Exam1 <span class="op">+</span><span class="st"> </span>Exam2 <span class="op">+</span><span class="st"> </span>Final)<span class="op">/</span><span class="dv">3</span>,
  <span class="dt">grade =</span> <span class="kw">cut</span>(average, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>),  <span class="co"># cut takes numeric variable</span>
                       <span class="kw">c</span>( <span class="st">&#39;F&#39;</span>,<span class="st">&#39;D&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>)) )  <span class="co"># and makes a factor</span></code></pre></div>
<pre><code>##   l.name Exam1 Exam2 Final  average grade
## 1    Cox    93    98    96 95.66667     A
## 2 Dorian    89    70    85 81.33333     B
## 3  Kelso    80    82    81 81.00000     B
## 4   Turk    70    85    92 82.33333     B</code></pre>
</div>
<div id="summarise" class="section level4">
<h4><span class="header-section-number">1.2.1.4</span> summarise()</h4>
<p>By itself, this function is quite boring, but will become useful later on. Its purpose is to calculate summary statistics using any or all of the data columns. Notice that we get to chose the name of the new column. The way to think about this is that we are collapsing information stored in multiple rows into a single row of values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the mean of exam 1</span>
grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>( <span class="dt">mean.E1=</span><span class="kw">mean</span>(Exam1))</code></pre></div>
<pre><code>##   mean.E1
## 1      83</code></pre>
<p>We could calculate multiple summary statistics if we like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the mean and standard deviation </span>
grades <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>( <span class="dt">mean.E1=</span><span class="kw">mean</span>(Exam1), <span class="dt">stddev.E1=</span><span class="kw">sd</span>(Exam2) )</code></pre></div>
<pre><code>##   mean.E1 stddev.E1
## 1      83      11.5</code></pre>
<p>If we want to apply the same statistic to each column, we use the <code>summarise_each()</code> command. We have to be a little careful here because the function you use has to work on every column (that isn’t part of the grouping structure (see <code>group_by()</code>)).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the mean and stddev of each column - Cannot do this to Names!</span>
grades <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>( Exam1<span class="op">:</span>Final ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise_each</span>( <span class="kw">funs</span>(mean, sd) )</code></pre></div>
<pre><code>## `summarise_each()` is deprecated.
## Use `summarise_all()`, `summarise_at()` or `summarise_if()` instead.
## To map `funs` over all variables, use `summarise_all()`</code></pre>
<pre><code>##   Exam1_mean Exam2_mean Final_mean Exam1_sd Exam2_sd Final_sd
## 1         83      83.75       88.5 10.23067     11.5 6.757712</code></pre>
</div>
<div id="miscellaneous-functions" class="section level4">
<h4><span class="header-section-number">1.2.1.5</span> Miscellaneous functions</h4>
<p>There are some more function that are useful but aren’t as commonly used. For sampling the functions <code>sample_n()</code> and <code>sample_frac()</code> will take a subsample of either n rows or of a fraction of the data set. The function <code>n()</code> returns the number of rows in the data set. Finally <code>rename()</code> will rename a selected column.</p>
</div>
</div>
<div id="split-apply-combine" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Split, apply, combine</h3>
<p>Aside from unifying the syntax behind the common operations, the major strength of the <code>dplyr</code> package is the ability to split a data frame into a bunch of sub-dataframes, apply a sequence of one or more of the operations we just described, and then combine results back together. We’ll consider data from an experiment from spinning wool into yarn. This experiment considered two different types of wool (A or B) and three different levels of tension on the thread. The response variable is the number of breaks in the resulting yarn. For each of the 6 <code>wool:tension</code> combinations, there are 9 replicated observations per <code>wool:tension</code> level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(warpbreaks)
<span class="kw">str</span>(warpbreaks)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    54 obs. of  3 variables:
##  $ breaks : num  26 30 54 25 70 52 51 26 67 18 ...
##  $ wool   : Factor w/ 2 levels &quot;A&quot;,&quot;B&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ tension: Factor w/ 3 levels &quot;L&quot;,&quot;M&quot;,&quot;H&quot;: 1 1 1 1 1 1 1 1 1 2 ...</code></pre>
<p>The first we must do is to create a data frame with additional information about how to break the data into sub-dataframes. In this case, I want to break the data up into the 6 wool-by-tension combinations. Initially we will just figure out how many rows are in each wool-by-tension combination.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># group_by:  what variable(s) shall we group one</span>
<span class="co"># n() is a function that returns how many rows are in the </span>
<span class="co">#   currently selected sub-dataframe</span>
warpbreaks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>( wool, tension) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># grouping</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>() )             <span class="co"># how many in each group</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   wool [?]
##     wool tension     n
##   &lt;fctr&gt;  &lt;fctr&gt; &lt;int&gt;
## 1      A       L     9
## 2      A       M     9
## 3      A       H     9
## 4      B       L     9
## 5      B       M     9
## 6      B       H     9</code></pre>
<p>The <code>group_by</code> function takes a data.frame and returns the same data.frame, but with some extra information so that any subsequent function acts on each unique combination defined in the <code>group_by</code>. If you wish to remove this behavior, use <code>group_by()</code> to reset the grouping to have no grouping variable.</p>
<p>Using the same <code>summarise</code> function, we could calculate the group mean and standard deviation for each wool-by-tension group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">warpbreaks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(wool, tension) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>( <span class="dt">n           =</span> <span class="kw">n</span>(),             <span class="co"># I added some formatting to show the</span>
             <span class="dt">mean.breaks =</span> <span class="kw">mean</span>(breaks),    <span class="co"># reader I am calculating several</span>
             <span class="dt">sd.breaks   =</span> <span class="kw">sd</span>(breaks))      <span class="co"># statistics.</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
## # Groups:   wool [?]
##     wool tension     n mean.breaks sd.breaks
##   &lt;fctr&gt;  &lt;fctr&gt; &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1      A       L     9    44.55556 18.097729
## 2      A       M     9    24.00000  8.660254
## 3      A       H     9    24.55556 10.272671
## 4      B       L     9    28.22222  9.858724
## 5      B       M     9    28.77778  9.431036
## 6      B       H     9    18.77778  4.893306</code></pre>
<p>If instead of summarizing each split, we might want to just do some calculation and the output should have the same number of rows as the input data frame. In this case I’ll tell <code>dplyr</code> that we are mutating the data frame instead of summarizing it. For example, suppose that I want to calculate the residual value <span class="math display">\[e_{ijk}=y_{ijk}-\bar{y}_{ij\cdot}\]</span> where <span class="math inline">\(\bar{y}_{ij\cdot}\)</span> is the mean of each <code>wool:tension</code> combination.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">warpbreaks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">   </span><span class="kw">group_by</span>(wool, tension) <span class="op">%&gt;%</span><span class="st">                 </span><span class="co"># group by wool:tension</span>
<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">resid =</span> breaks <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(breaks)) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># mean(breaks) of the group!</span>
<span class="st">   </span><span class="kw">head</span>(  )                                    <span class="co"># show the first couple of rows</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   wool, tension [1]
##   breaks   wool tension      resid
##    &lt;dbl&gt; &lt;fctr&gt;  &lt;fctr&gt;      &lt;dbl&gt;
## 1     26      A       L -18.555556
## 2     30      A       L -14.555556
## 3     54      A       L   9.444444
## 4     25      A       L -19.555556
## 5     70      A       L  25.444444
## 6     52      A       L   7.444444</code></pre>
</div>
<div id="chaining-commands-together" class="section level3">
<h3><span class="header-section-number">1.2.3</span> Chaining commands together</h3>
<p>In the previous examples we have used the <code>%&gt;%</code> operator to make the code more readable but to really appreciate this, we should examine the alternative.</p>
<p>Suppose we have the results of a small 5K race. The data given to us is in the order that the runners signed up but we want to calculate the results for each gender, calculate the placings, and the sort the data frame by gender and then place. We can think of this process as having three steps:</p>
<ol style="list-style-type: decimal">
<li>Splitting</li>
<li>Ranking</li>
<li>Re-arranging.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># input the initial data</span>
race.results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">name=</span><span class="kw">c</span>(<span class="st">&#39;Bob&#39;</span>, <span class="st">&#39;Jeff&#39;</span>, <span class="st">&#39;Rachel&#39;</span>, <span class="st">&#39;Bonnie&#39;</span>, <span class="st">&#39;Derek&#39;</span>, <span class="st">&#39;April&#39;</span>,<span class="st">&#39;Elise&#39;</span>,<span class="st">&#39;David&#39;</span>),
  <span class="dt">time=</span><span class="kw">c</span>(<span class="fl">21.23</span>, <span class="fl">19.51</span>, <span class="fl">19.82</span>, <span class="fl">23.45</span>, <span class="fl">20.23</span>, <span class="fl">24.22</span>, <span class="fl">28.83</span>, <span class="fl">15.73</span>),
  <span class="dt">gender=</span><span class="kw">c</span>(<span class="st">&#39;M&#39;</span>,<span class="st">&#39;M&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;M&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;M&#39;</span>))</code></pre></div>
<p>We could run all the commands together using the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>( 
  <span class="kw">mutate</span>(
    <span class="kw">group_by</span>( 
      race.results,         <span class="co"># using race.results</span>
      gender),              <span class="co"># group by gender     </span>
    <span class="dt">place =</span> <span class="kw">rank</span>( time )),  <span class="co"># mutate to calculate the place column</span>
  gender, place)            <span class="co"># arrange the result by gender and place</span></code></pre></div>
<pre><code>## # A tibble: 8 x 4
## # Groups:   gender [2]
##     name  time gender place
##   &lt;fctr&gt; &lt;dbl&gt; &lt;fctr&gt; &lt;dbl&gt;
## 1 Rachel 19.82      F     1
## 2 Bonnie 23.45      F     2
## 3  April 24.22      F     3
## 4  Elise 28.83      F     4
## 5  David 15.73      M     1
## 6   Jeff 19.51      M     2
## 7  Derek 20.23      M     3
## 8    Bob 21.23      M     4</code></pre>
<p>This is very difficult to read because you have to read the code <em>from the inside out</em>.</p>
<p>Another (and slightly more readable) way to complete our task is to save each intermediate step of our process and then use that in the next step:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp.df0 &lt;-<span class="st"> </span>race.results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>( gender)
temp.df1 &lt;-<span class="st"> </span>temp.df0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>( <span class="dt">place =</span> <span class="kw">rank</span>(time) )
temp.df2 &lt;-<span class="st"> </span>temp.df1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>( gender, place )</code></pre></div>
<p>It would be nice if I didn’t have to save all these intermediate results because keeping track of temp1 and temp2 gets pretty annoying if I keep changing the order of how things or calculated or add/subtract steps. This is exactly what <code>%&gt;%</code> does for me.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">race.results <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>( gender ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>( <span class="dt">place =</span> <span class="kw">rank</span>(time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>( gender, place )</code></pre></div>
<pre><code>## # A tibble: 8 x 4
## # Groups:   gender [2]
##     name  time gender place
##   &lt;fctr&gt; &lt;dbl&gt; &lt;fctr&gt; &lt;dbl&gt;
## 1 Rachel 19.82      F     1
## 2 Bonnie 23.45      F     2
## 3  April 24.22      F     3
## 4  Elise 28.83      F     4
## 5  David 15.73      M     1
## 6   Jeff 19.51      M     2
## 7  Derek 20.23      M     3
## 8    Bob 21.23      M     4</code></pre>
</div>
</div>
<div id="reshaping-data" class="section level2">
<h2><span class="header-section-number">1.3</span> Reshaping data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)   <span class="co"># for the gather/spread commands</span>
<span class="kw">library</span>(dplyr)   <span class="co"># for the join stuff</span></code></pre></div>
<p>Most of the time, our data is in the form of a data frame and we are interested in exploring the relationships. However most procedures in R expect the data to show up in a ‘long’ format where each row is an observation and each column is a covariate. In practice, the data is often not stored like that and the data comes to us with repeated observations included on a single row. This is often done as a memory saving technique or because there is some structure in the data that makes the ‘wide’ format attractive. As a result, we need a way to convert data from ‘wide’ to ‘long’ and vice-versa.</p>
<div id="tidyr" class="section level3">
<h3><span class="header-section-number">1.3.1</span> <code>tidyr</code></h3>
<p>There is a common issue with obtaining data with many columns that you wish were organized as rows. For example, I might have data in a grade book that has several homework scores and I’d like to produce a nice graph that has assignment number on the x-axis and score on the y-axis. Unfortunately this is incredibly hard to do when the data is arranged in the following way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grade.book &lt;-<span class="st"> </span><span class="kw">rbind</span>(
  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Alison&#39;</span>,  <span class="dt">HW.1=</span><span class="dv">8</span>, <span class="dt">HW.2=</span><span class="dv">5</span>, <span class="dt">HW.3=</span><span class="dv">8</span>),
  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Brandon&#39;</span>, <span class="dt">HW.1=</span><span class="dv">5</span>, <span class="dt">HW.2=</span><span class="dv">3</span>, <span class="dt">HW.3=</span><span class="dv">6</span>),
  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Charles&#39;</span>, <span class="dt">HW.1=</span><span class="dv">9</span>, <span class="dt">HW.2=</span><span class="dv">7</span>, <span class="dt">HW.3=</span><span class="dv">9</span>))
grade.book</code></pre></div>
<pre><code>##      name HW.1 HW.2 HW.3
## 1  Alison    8    5    8
## 2 Brandon    5    3    6
## 3 Charles    9    7    9</code></pre>
<p>What we want to do is turn this data frame from a <em>wide</em> data frame into a <em>long</em> data frame. In MS Excel this is called pivoting. Essentially I’d like to create a data frame with three columns: <code>name</code>, <code>assignment</code>, and <code>score</code>. That is to say that each homework datum really has three pieces of information: who it came from, which homework it was, and what the score was. It doesn’t conceptually matter if I store it as 3 columns or 3 rows so long as there is a way to identify how a student scored on a particular homework. So we want to reshape the HW1 to HW3 columns into two columns (assignment and score).</p>
<p>This package was built by the sample people that created dplyr and ggplot2 and there is a nice introduction at: [<a href="http://blog.rstudio.org/2014/07/22/introducing-tidyr/" class="uri">http://blog.rstudio.org/2014/07/22/introducing-tidyr/</a>]</p>
<div id="verbs-1" class="section level4">
<h4><span class="header-section-number">1.3.1.1</span> Verbs</h4>
<p>As with the dplyr package, there are two main verbs to remember:</p>
<ol style="list-style-type: decimal">
<li><p><code>gather</code> - Gather multiple columns that are related into two columns that contain the original column name and the value. For example for columns HW1, HW2, HW3 we would gather them into two column HomeworkNumber and Score. In this case, we refer to HomeworkNumber as the key column and Score as the value column. So for any key:value pair you know everything you need.</p></li>
<li><p><code>spread</code> - This is the opposite of gather. This takes a key column (or columns) and a results column and forms a new column for each level of the key column(s).</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first we gather the score columns into columns we&#39;ll name Assesment and Score</span>
tidy.scores &lt;-<span class="st"> </span>grade.book <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>( <span class="dt">key=</span>Assessement,  <span class="co"># What should I call the key column</span>
          <span class="dt">value=</span>Score,      <span class="co"># What should I call the values column</span>
          HW.<span class="dv">1</span><span class="op">:</span>HW.<span class="dv">3</span>         <span class="co"># which columns to apply this to</span>
          )
tidy.scores</code></pre></div>
<pre><code>##      name Assessement Score
## 1  Alison        HW.1     8
## 2 Brandon        HW.1     5
## 3 Charles        HW.1     9
## 4  Alison        HW.2     5
## 5 Brandon        HW.2     3
## 6 Charles        HW.2     7
## 7  Alison        HW.3     8
## 8 Brandon        HW.3     6
## 9 Charles        HW.3     9</code></pre>
<p>To spread the key:value pairs out into a matrix, we use the <code>spread()</code> command.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Turn the Assessment/Score pair of columns into one column per factor level of Assessment</span>
tidy.scores <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>( <span class="dt">key=</span>Assessement, <span class="dt">value=</span>Score )</code></pre></div>
<pre><code>##      name HW.1 HW.2 HW.3
## 1  Alison    8    5    8
## 2 Brandon    5    3    6
## 3 Charles    9    7    9</code></pre>
<p>One way to keep straight which is the <code>key</code> column is that the key is the category, while <code>value</code> is the numerical value or response.</p>
</div>
</div>
</div>
<div id="storing-data-in-multiple-tables" class="section level2">
<h2><span class="header-section-number">1.4</span> Storing Data in Multiple Tables</h2>
<p>In many datasets it is common to store data across multiple tables, usually with the goal of minimizing memory used as well as providing minimal duplication of information so any change that must be made is only made in a single place.</p>
<p>To see the rational why we might do this, consider building a data set of blood donations by a variety of donors across several years. For each blood donation, we will perform some assay and measure certain qualities about the blood and the patients health at the donation.</p>
<pre><code>##   Donor Hemoglobin Systolic Diastolic
## 1 Derek       17.4      121        80
## 2  Jeff       16.9      145       101</code></pre>
<p>But now we have to ask, what happens when we have a donor that has given blood multiple times? In this case we should just have multiple rows per person along with a date column to uniquely identify a particular donation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">donations</code></pre></div>
<pre><code>##   Donor       Date Hemoglobin Systolic Diastolic
## 1 Derek 2017-04-14       17.4      120        79
## 2 Derek 2017-06-20       16.5      121        80
## 3  Jeff 2017-08-14       16.9      145       101</code></pre>
<p>I would like to include additional information about the donor where that infomation doesn’t change overtime. For example we might want to have information about the donar’s birthdate, sex, blood type. However, I don’t want that information in <em>every single donation line</em>. Otherwise if I mistype a birthday and have to correct it, I would have to correct it <em>everywhere</em>. For information about the donor, should live in a <code>donors</code> table, while information about a particular donation should live in the <code>donations</code> table.</p>
<p>Furthermore, there are many Jeffs and Dereks in the world and to maintain a unique identifier (without using Social Security numbers) I will just create a <code>Donor_ID</code> code that will uniquely identify a person. Similarly I will create a <code>Donation_ID</code> that will uniquely identify a dontation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">donors</code></pre></div>
<pre><code>##   Donor_ID F_Name L_Name B_Type      Birth       Street      City State
## 1  Donor_1  Derek    Lee     O+ 1976-09-17 7392 Willard Flagstaff    AZ
## 2  Donor_2   Jeff  Smith      A 1974-06-23     873 Vine   Bozeman    MT</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">donations</code></pre></div>
<pre><code>##   Donation_ID Donor_ID       Date Hemoglobin Systolic Diastolic
## 1  Donation_1  Donor_1 2017-04-14       17.4      120        79
## 2  Donation_2  Donor_1 2017-06-20       16.5      121        80
## 3  Donation_3  Donor_2 2017-08-14       16.9      145       101</code></pre>
<p>If we have a new donor walk in and give blood, then we’ll have to create a new entry in the <code>donors</code> table as well as a new entry in the <code>donations</code> table. If an experienced donor gives again, we just have to create a new entry in the donations table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">donors</code></pre></div>
<pre><code>##   Donor_ID F_Name L_Name B_Type      Birth       Street      City State
## 1  Donor_1  Derek    Lee     O+ 1976-09-17 7392 Willard Flagstaff    AZ
## 2  Donor_2   Jeff  Smith      A 1974-06-23     873 Vine   Bozeman    MT
## 3  Donor_3 Aubrey    Lee     O+ 1980-12-15 7392 Willard Flagstaff    AZ</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">donations</code></pre></div>
<pre><code>##   Donation_ID Donor_ID       Date Hemoglobin Systolic Diastolic
## 1  Donation_1  Donor_1 2017-04-14       17.4      120        79
## 2  Donation_2  Donor_1 2017-06-20       16.5      121        80
## 3  Donation_3  Donor_2 2017-08-14       16.9      145       101
## 4  Donation_4  Donor_1 2017-08-26       17.6      120        79
## 5  Donation_5  Donor_4 2017-08-26       16.1      137        90</code></pre>
<p>This data storage set-up might be flexible enough for us. However what happens if somebody moves? If we don’t want to keep the historical information, then we could just change the person’s <code>Street_Address</code>, <code>City</code>, and <code>State</code> values. If we do want to keep that, then we could create <code>donor_addresses</code> table that contains a <code>Start_Date</code> and <code>End_Date</code> that denotes the period of time that the address was valid.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">donor_addresses</code></pre></div>
<pre><code>##   Donor_ID       Street      City State Start_Date   End_Date
## 1  Donor_1 346 Treeline   Pullman    WA 2015-01-26 2016-06-27
## 2  Donor_1     645 Main Flagstsff    AZ 2016-06-28 2017-07-02
## 3  Donor_1 7392 Willard Flagstaff    AZ 2017-07-03       &lt;NA&gt;
## 4  Donor_2     873 Vine   Bozeman    MT 2015-03-17       &lt;NA&gt;
## 5  Donor_3 7392 Willard Flagstaff    AZ 2017-06-01       &lt;NA&gt;</code></pre>
<p>Given this data structure, we can now easily create new donations as well as store donor information. In the event that we need to change something about a donor, there is only <em>one</em> place to make that change.</p>
<p>However, having data spread across multiple tables is challenging because I often want that information squished back together. For example, the blood donations services might want to find all ‘O’ or ‘O+’ donors in Flagstaff and their current mailing address and send them some notification about blood supplies being low. So we need someway to join the <code>donors</code> and <code>donor_addresses</code> tables together in a sensible manner.</p>
<div id="table-joins" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Table Joins</h3>
<p>Often we need to squish together two data frames but they do not have the same number of rows. Consider the case where we have a data frame of observations of fish and a separate data frame that contains information about lake (perhaps surface area, max depth, pH, etc). I want to store them as two separate tables so that when I have to record a lake level observation, I only input it <em>one</em> place. This decreases the chance that I make a copy/paste error.</p>
<p>To illustrate the different types of table joins, we’ll consider two different tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tibbles are just data.frames that print a bit nicer and don&#39;t automaticall</span>
<span class="co"># convert character columns into factors.  They behave a bit more consistently</span>
<span class="co"># in a wide variety of situations compared to data.frames.</span>
Fish.Data &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">Lake_ID =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;C&#39;</span>), 
  <span class="dt">Fish.Weight=</span><span class="kw">rnorm</span>(<span class="dv">6</span>, <span class="dt">mean=</span><span class="dv">260</span>, <span class="dt">sd=</span><span class="dv">25</span>) ) <span class="co"># make up some data</span>
Lake.Data &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">Lake_ID =</span> <span class="kw">c</span>(    <span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>),   
  <span class="dt">Lake_Name =</span> <span class="kw">c</span>(<span class="st">&#39;Lake Elaine&#39;</span>, <span class="st">&#39;Mormon Lake&#39;</span>, <span class="st">&#39;Lake Mary&#39;</span>),   
  <span class="dt">pH=</span><span class="kw">c</span>(<span class="fl">6.5</span>, <span class="fl">6.3</span>, <span class="fl">6.1</span>),
  <span class="dt">area =</span> <span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">210</span>, <span class="dv">240</span>),
  <span class="dt">avg_depth =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">38</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Fish.Data</code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   Lake_ID Fish.Weight
##     &lt;chr&gt;       &lt;dbl&gt;
## 1       A    268.4052
## 2       A    237.3458
## 3       B    227.0830
## 4       B    261.5135
## 5       C    262.9933
## 6       C    235.9487</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Lake.Data</code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Lake_ID   Lake_Name    pH  area avg_depth
##     &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1       B Lake Elaine   6.5    40         8
## 2       C Mormon Lake   6.3   210        10
## 3       D   Lake Mary   6.1   240        38</code></pre>
<p>Notice that each of these tables has a column labled <code>Lake_ID</code>. When we join these two tables, the row that describes lake <code>A</code> should be duplicated for each row in the <code>Fish.Data</code> that corresponds with fish caught from lake <code>A</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">full_join</span>(Fish.Data, Lake.Data)</code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 7 x 6
##   Lake_ID Fish.Weight   Lake_Name    pH  area avg_depth
##     &lt;chr&gt;       &lt;dbl&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1       A    268.4052        &lt;NA&gt;    NA    NA        NA
## 2       A    237.3458        &lt;NA&gt;    NA    NA        NA
## 3       B    227.0830 Lake Elaine   6.5    40         8
## 4       B    261.5135 Lake Elaine   6.5    40         8
## 5       C    262.9933 Mormon Lake   6.3   210        10
## 6       C    235.9487 Mormon Lake   6.3   210        10
## 7       D          NA   Lake Mary   6.1   240        38</code></pre>
<p>Notice that because we didn’t have any fish caught in lake <code>D</code> and we don’t have any Lake information about lake <code>A</code>, when we join these two tables, we end up introducing missing observations into the resulting data frame.</p>
<p>The other types of joins govern the behavor or these missing data.</p>
<p><strong><code>left_join(A, B)</code></strong> For each row in A, match with a row in B, but don’t create any more rows than what was already in A.</p>
<p><strong><code>inner_join(A,B)</code></strong> Only match row values where both data frames have a value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">left_join</span>(Fish.Data, Lake.Data)</code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 6 x 6
##   Lake_ID Fish.Weight   Lake_Name    pH  area avg_depth
##     &lt;chr&gt;       &lt;dbl&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1       A    268.4052        &lt;NA&gt;    NA    NA        NA
## 2       A    237.3458        &lt;NA&gt;    NA    NA        NA
## 3       B    227.0830 Lake Elaine   6.5    40         8
## 4       B    261.5135 Lake Elaine   6.5    40         8
## 5       C    262.9933 Mormon Lake   6.3   210        10
## 6       C    235.9487 Mormon Lake   6.3   210        10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">inner_join</span>(Fish.Data, Lake.Data)</code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 4 x 6
##   Lake_ID Fish.Weight   Lake_Name    pH  area avg_depth
##     &lt;chr&gt;       &lt;dbl&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1       B    227.0830 Lake Elaine   6.5    40         8
## 2       B    261.5135 Lake Elaine   6.5    40         8
## 3       C    262.9933 Mormon Lake   6.3   210        10
## 4       C    235.9487 Mormon Lake   6.3   210        10</code></pre>
<p>The above examples assumed that the column used to join the two tables was named the same in both tables. This is good practice to try to do, but sometimes you have to work with data where that isn’t the case. In that situation you can use the <code>by=c(&quot;ColName.A&quot;=&quot;ColName.B&quot;)</code> syntax where <code>ColName.A</code> represents the name of the column in the first data frame and <code>ColName.B</code> is the equivalent column in the second data frame.</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">1.5</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>The dataset <code>ChickWeight</code> tracks the weights of 48 baby chickens (chicks) feed four different diets.
<ol style="list-style-type: lower-alpha">
<li><p>Load the dataset using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ChickWeight)</code></pre></div></li>
<li>Look at the help files for the description of the columns.</li>
</ol>
<ol start="3" style="list-style-type: lower-alpha">
<li>Remove all the observations except for the weights on day 10 and day 20.</li>
<li>Calculate the mean and standard deviation for each diet group on days 10 and 20.</li>
</ol></li>
<li>The OpenIntro textbook on statistics includes a data set on body dimensions.
<ol style="list-style-type: lower-alpha">
<li><p>Load the file using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Body &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;http://www.openintro.org/stat/data/bdims.csv&#39;</span>)</code></pre></div></li>
<li>The column sex is coded as a 1 if the individual is male and 0 if female. This is a non-intuitive labeling system. Create a new column <code>sex.MF</code> that uses labels Male and Female.</li>
<li><p>The columns wgt and hgt measure weight and height in kilograms and centimeters (respectively). Use these to calculate the Body Mass Index (BMI) for each individual where <span class="math display">\[BMI=\frac{Weight\,(kg)}{\left[Height\,(m)\right]^{2}}\]</span></p></li>
<li><p>Double check that your calculated BMI column is correct by examining the summary statistics of the column. BMI values should be between 18 to 40 or so. Did you make an error in your calculation?</p></li>
<li><p>The function <code>cut</code> takes a vector of continuous numerical data and creates a factor based on your give cut-points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define a continuous vector to convert to a factor</span>
x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>

<span class="co"># divide range of x into three groups of equal length</span>
<span class="kw">cut</span>(x, <span class="dt">breaks=</span><span class="dv">3</span>)

<span class="co"># divide x into four groups, where I specify all 5 break points </span>
<span class="kw">cut</span>(x, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="fl">5.0</span>, <span class="fl">7.5</span>, <span class="dv">10</span>))
<span class="co"># (0,2.5] (2.5,5] means 2.5 is included in first group</span>
<span class="co"># right=FALSE changes this to make 2.5 included in the second  </span>

<span class="co"># divide x into 3 groups, but give them a nicer</span>
<span class="co"># set of group names</span>
<span class="kw">cut</span>(x, <span class="dt">breaks=</span><span class="dv">3</span>, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&#39;Low&#39;</span>,<span class="st">&#39;Medium&#39;</span>,<span class="st">&#39;High&#39;</span>))</code></pre></div>
<p>Create a new column of in the data frame that divides the age into decades (10-19, 20-29, 30-39, etc). Notice the oldest person in the study is 67.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Body &lt;-<span class="st"> </span>Body <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>( <span class="dt">Age.Grp =</span> <span class="kw">cut</span>(age,
                        <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>),
                        <span class="dt">right=</span><span class="ot">FALSE</span>))</code></pre></div></li>
<li><p>Find the average BMI for each Sex and Age group.</p></li>
</ol></li>
<li><p>Suppose we are given information about the maximum daily temperature from a weather station in Flagstaff, AZ. The file is available at the GitHub site that this book is hosted on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FlagTemp &lt;-<span class="st">  </span><span class="kw">read.csv</span>(
  <span class="st">&#39;https://github.com/dereksonderegger/570L/raw/master/data-raw/FlagMaxTemp.csv&#39;</span>,
   <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&#39;,&#39;</span>)</code></pre></div>
<p>This file is in a wide format, where each row represents a month and the columns X1, X2, …, X31 represent the day of the month the observation was made.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Convert data set to the long format where the data has only four columns: <code>Year</code>, <code>Month</code>, <code>Day</code>, <code>Tmax</code>.</p></li>
<li><p>Calculate the average monthly maximum temperature for each Month in the dataset (So there will be 365 mean maximum temperatures). <em>You’ll probably have some issues taking the mean because there are a number of values that are missing and by default R refuses to take means and sums when there is missing data. The argument <code>na.rm=TRUE</code> to <code>mean()</code> allows you to force R to remove the missing observations before calculating the mean.</em></p></li>
<li><p>Convert the average month maximums back to a wide data format where each line represents a year and there are 12 columns of temperature data (one for each month) along with a column for the year. <em>There will be a couple of months that still have missing data because the weather station was out of commision for those months and there was NO data for the entire month.</em></p></li>
</ol></li>
<li>A common task is to take a set of data that has multiple categorical variables and create a table of the number of cases for each combination. An introductory statistics textbook contains a dataset summarizing student surveys from several sections of an intro class. The two variables of interest for us are <code>Gender</code> and <code>Year</code> which are the students gender and year in college.
<ol style="list-style-type: lower-alpha">
<li><p>Download the dataset and correctly order the <code>Year</code> variable using the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Survey &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;http://www.lock5stat.com/datasets/StudentSurvey.csv&#39;</span>, <span class="dt">na.strings=</span><span class="kw">c</span>(<span class="st">&#39;&#39;</span>,<span class="st">&#39; &#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">Year =</span> <span class="kw">factor</span>(Year, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&#39;FirstYear&#39;</span>,<span class="st">&#39;Sophomore&#39;</span>,<span class="st">&#39;Junior&#39;</span>,<span class="st">&#39;Senior&#39;</span>)))</code></pre></div></li>
<li>Using some combination of <code>dplyr</code> functions, produce a data set with eight rows that contains the number of responses for each gender:year combination. <em>Notice there are two females that neglected to give their Year and you should remove them first. The function <code>is.na(Year)</code> will return logical values indicating if the Year value was missing and you can flip those values using the negation operator <code>!</code>. So you might consider using <code>!is.na(Year)</code> as the argument to a filter() command. Alternatively you sort on Year and remove the first two rows using <code>slice(-2:-1)</code>. Next you’ll want to summarize each Year/Gender group using the <code>n()</code> function which gives the number of rows in a data set.</em></li>
<li><p>Using <code>tidyr</code> commands, produce a table of the number of responses in the following form:</p>
<table>
<thead>
<tr class="header">
<th>Gender</th>
<th>First Year</th>
<th>Sophmore</th>
<th>Junior</th>
<th>Senior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Female</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Male</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table></li>
</ol></li>
<li><p>The package <code>nycflights</code> contains information about all the flights that arrived in or left from New York City in 2013. This package contains five data tables, but there are three data tables we will work with. The data table <code>flights</code> gives information about a particular flight, <code>airports</code> gives information about a particular airport, and <code>airlines</code> gives information about each airline. Create a table of all the flights on February 14th by Virgin America that has columns for the carrier, destination, departure time, and flight duration. Join this table with the airports information for the destination. Notice that because the column for the destination airport code doesn’t match up between <code>flights</code> and <code>airports</code>, you’ll have to use the <code>by=c(&quot;TableA.Col&quot;=&quot;TableB.Col&quot;)</code> argument where you insert the correct names for <code>TableA.Col</code> and <code>TableB.Col</code>.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="2-markov-chain-monte-carlo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dereksonderegger/578/raw/master/01_DataManipulation.Rmd",
"text": "Edit"
},
"download": [["Statistical_Computing_Notes.pdf", "PDF"], ["Statistical_Computing_Notes.epub", "EPUB"]],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
